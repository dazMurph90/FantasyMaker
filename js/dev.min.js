var initCanvas={};console.log("Enter initCanvas.js");
var cy=cytoscape({container:document.getElementById("cy"),layout:{name:"grid",rows:1},style:[{selector:"node",style:{content:"data(id)","text-opacity":1,"text-valign":"center","text-halign":"center","border-width":5,"border-opacity":0}},{selector:"edge",style:{width:4,"target-arrow-shape":"triangle","line-color":"#9dbaea","target-arrow-color":"#9dbaea","curve-style":"bezier"}},{selector:":selected",style:{"border-opacity":1,"line-color":"black","target-arrow-color":"black"}},{selector:".page",style:{shape:"roundrectangle",
"background-color":"light-gray"}},{selector:".control",style:{shape:"ellipse","background-color":"red"}}],elements:{nodes:[],edges:[]},selectionType:"single",minZoom:1E-10,maxZoom:1E10});console.log("Canvas done");var states={DEFAULT:0,CONNECTING:1,NEWPAGE:2,NEWCONTROL:3};current_state=states.DEFAULT;
function changeState(a){$("#sidebar .button").removeClass("activebutton");$(a).addClass("activebutton");$(a).hasClass("connectionmode")&&current_state!=states.CONNECTING?(current_state=states.CONNECTING,source_node=null):$(a).hasClass("pagemode")&&current_state!=states.NEWPAGE?current_state=states.NEWPAGE:$(a).hasClass("controlmode")&&current_state!=states.NEWCONTROL?current_state=states.NEWCONTROL:($(a).hasClass("deletebutton")&&current_state!=states.DEFAULT&&removeNode(),setDefaultState(a))}
function setDefaultState(a){source_node=null;current_state=states.DEFAULT;$(a).removeClass("activebutton")};var ui={};function updateEditPane(a){a.hasClass("control")?($("#editcontrol").show(),$("#controlname").text("control "+a.data("id")),document.getElementById("controltext").value=a.data("text")):a.hasClass("page")?($("#editpage").show(),$("#pagename").text("Page "+a.data("id")),document.getElementById("pagetext").value=a.data("text")):a.hasClass("connection")&&($("#editconnection").show(),$("#connectionname").text("Connection"),document.getElementById("connectiontext").value=a.data("text"))}
function hideEditPanes(){$("#editpage").hide();$("#editcontrol").hide();$("#editconnection").hide();$(".connectionmode").hide();$(".deletebutton").hide()}$(".textarea").on("input",function(a){a=this.value;cy.$(":selected").data("text",a);console.log("For element ",cy.$(":selected").data("id"),"apply",this.value," Now holds: ",cy.$(":selected").data("text"))});function removeNode(){node=cy.$(":selected");node.empty()||(cy.remove(node),hideEditPanes())}
function createConnection(a){current_state==states.CONNECTING&&a.isNode()&&(null==source_node?(source_node=a,console.log("Source node assigned as node",a.data("id"))):(console.log("Creating link from ",source_node.data("id")," to ",a.data("id")),source_node.data("id")!=a.data("id")&&(cy.add({data:{source:source_node.data("id"),target:a.data("id"),text:"<Decision text to display)>"},classes:"connection",group:"edges"}),source_node=null)))};var canvasEvents={};console.log("Enter canvasEvents.js");total_pages=0;
cy.on("tap",function(a){var b=a.cyTarget;console.log("You tapped on: ",b);console.log("Target is: ",cy.$(":selected"));current_state===states.CONNECTING&&cy.$(":selected").empty()&&(console.log("USER: please select a valid node to connect to"),source_node.select());current_state===states.NEWPAGE?b===cy&&cy.add({data:{id:++total_pages,text:"page text"},classes:"page",group:"nodes",renderedPosition:a.cyRenderedPosition}):current_state===states.NEWCONTROL&&b===cy&&cy.add({data:{id:++total_pages,text:"control node text"},
classes:"control",group:"nodes",renderedPosition:a.cyRenderedPosition})});cy.on("select",function(a){a=cy.$(":selected");$(".connectionmode").show();$(".deletebutton").show();console.log("Select: ",a.data("id"));createConnection(a);updateEditPane(a)});cy.on("tap",":selected",function(a){current_state===states.CONNECTING&&(console.log("Connection node registered as currently selected node"),createConnection(cy.$(":selected")))});cy.on("unselect",function(a){cy.$(":selected").empty()&&hideEditPanes()});console.log("Enter main.js");
